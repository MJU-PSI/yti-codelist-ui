<div *ngIf="loading">
  Loading...
  <!--TODO ajax indicator-->
</div>

<div class="row" *ngIf="!loading">
  <div class="col-12">
    <div class="content-box">

      <app-back-button (click)="back()"></app-back-button>

      <div class="row mt-2 mb-2">
        <h1>{{codeScheme.prefLabels[modifyLanguage]}}</h1>
      </div>

      <div class="row">
        <div class="col-md-9 px-0">
          <span class="status bold alignLeft" translate>{{codeScheme.status}}</span>
        </div>
        <div class="col-md-3">
          <div ngbDropdown class="d-inline-block">
            <button class="btn btn-outline-primary" id="exportDropdown" ngbDropdownToggle translate>Export</button>
            <div ngbDropdownMenu aria-labelledby="exportDropdown">
              <a href='{{codeScheme.uri}}codes/?format=csv' target="_blank" class="dropdown-item" translate>Export CSV</a>
              <a href='{{codeScheme.uri}}codes/?format=excel' target="_blank" class="dropdown-item" translate>Export Excel</a>
            </div>
          </div>
          <div ngbDropdown class="d-inline-block">
            <button class="btn btn-outline-primary" id="modifyLanguageDropdown" ngbDropdownToggle>{{modifyLanguage.toUpperCase()}}</button>
            <div ngbDropdownMenu class="dropdown-menu dropdown-menu-right" aria-labelledby="modifyLanguageDropdown">
              <div *ngFor="let language of languages">
                <button class='dropdown-item' [ngClass]="{'bold': language.code === modifyLanguage}" type="button" (click)='setModifyLanguage(language.code)'>{{language.name}}</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row" *ngIf='codeScheme.descriptions != null'>
        <p class="description">{{codeScheme.descriptions[modifyLanguage]}}</p>
      </div>

      <div class="row">
        <button class="tabNavi" (click)="showTab('codes')" translate>CODES</button>
        <button class="tabNavi" (click)="showTab('information')" translate>INFORMATION</button>
      </div>

      <div class="row" *ngIf='nav === "codes"'>
        <div class="table-responsive">
          <table class="table" *ngFor="let code of codes">
            <tr>
              <td><button class="btn btn-link code" (click)="viewCode(code)">{{code.codeValue}} - {{code.prefLabels[modifyLanguage]}}</button></td>
            </tr>
          </table>
        </div>
      </div>

      <div class="row" *ngIf='nav === "information"'>
        <div class="col-md-9 px-0">
          <label for="codeValue" translate>Code value</label>
          <span id="codeValue">{{codeScheme.codeValue}}</span>

          <div class="form-group">
            <label for="prefLabel" translate>Code name</label>
            <input type="text" class="form-control col-5" id="prefLabel" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.prefLabels[modifyLanguage]">
            <span *ngIf='!modifyEnabled'>{{codeScheme.prefLabels[modifyLanguage]}}</span>
          </div>

          <div class="form-group">
            <label for="description" translate>Description</label>
            <textarea type="text" rows="3" class="form-control col-10" id="description" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.descriptions[modifyLanguage]"></textarea>
            <span *ngIf='!modifyEnabled'>{{codeScheme.descriptions[modifyLanguage]}}</span>
          </div>

          <div class="form-group">
            <label for="definition" translate>Definition</label>
            <textarea type="text" rows="3" class="form-control col-10" id="definition" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.definitions[modifyLanguage]"></textarea>
            <span *ngIf='!modifyEnabled'>{{codeScheme.definitions[modifyLanguage]}}</span>
          </div>

          <div class="form-group">
            <label for="source" translate>Source</label>
            <input type="text" class="form-control col-5" id="source" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.source">
            <span *ngIf='!modifyEnabled'>{{codeScheme.source}}</span>
          </div>

          <div class="form-group">
            <label for="legalBase" translate>Legal base</label>
            <input type="text" class="form-contro col-5" id="legalBase" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.legalBase">
            <span *ngIf='!modifyEnabled'>{{codeScheme.legalBase}}</span>
          </div>
          <div class="form-group">
            <label for="governancePolicy" translate>Governance policy</label>
            <input type="text" class="form-control col-5" id="governancePolicy" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.governancePolicy">
            <span *ngIf='!modifyEnabled'>{{codeScheme.governancePolicy}}</span>
          </div>

          <div class="form-group">
            <label for="license" translate>License</label>
            <input type="text" class="form-control col-5" id="license" *ngIf='modifyEnabled' [(ngModel)]="codeScheme.license">
            <span *ngIf='!modifyEnabled'>{{codeScheme.license}}</span>
          </div>

          <label for="validity" translate>Validity</label>
          <span id="validity">{{codeScheme.startDate | date:'d.M.y'}} - {{codeScheme.endDate | date:'d.M.y'}}</span>

          <label for="lastModification" translate>Last modification</label>
          <span id="lastModification">{{codeScheme.modified | date:'d.M.y klo hh:mm'}}</span>
        </div>

        <div class="col-md-3 alignRight">
          <div class="row" *ngIf='!modifyEnabled'>
            <button type="button" class="btn actionbutton" (click)="modify()" translate>Modify</button>
          </div>
          <div class="row" *ngIf='modifyEnabled'>
            <button type="button" class="btn actionbutton" disabled (click)="save()" [disabled]='storing' translate>Save</button>
          </div>
          <div class="row" *ngIf='modifyEnabled'>
            <button type="button" class="btn btn-link linkbutton" (click)="cancel()" translate>Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
